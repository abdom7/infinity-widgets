<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Infinity Pro Cosmic Timer</title>
    <style>
        :root {
            --bg-color: #05070a;
            --text-color: #ffffff;
            --accent-color: #00d4ff;
        }

        body {
            margin: 0; padding: 0; height: 100vh; overflow: hidden;
            display: flex; justify-content: center; align-items: center;
            background: var(--bg-color);
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            color: var(--text-color);
        }

        #canvas { position: fixed; top: 0; left: 0; z-index: 1; pointer-events: none; }

        .container {
            position: relative; z-index: 10;
            text-align: center; width: 280px;
            padding: 30px; border-radius: 32px;
            background: rgba(255, 255, 255, 0.02);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.6);
        }

        #timer {
            font-size: 4.5rem; font-weight: 200; margin: 5px 0 20px 0;
            cursor: pointer; user-select: none;
            background: linear-gradient(to bottom, #fff, var(--accent-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-variant-numeric: tabular-nums;
        }

        .controls { display: flex; justify-content: center; gap: 12px; }

        .btn {
            background: rgba(255, 255, 255, 0.05); color: var(--text-color);
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 12px 24px; border-radius: 50px; cursor: pointer;
            font-size: 0.75rem; font-weight: 600; letter-spacing: 1.5px; 
            transition: all 0.3s ease;
            text-transform: uppercase;
        }

        .btn:hover { 
            border-color: var(--accent-color); 
            background: rgba(0, 212, 255, 0.1);
            transform: translateY(-2px);
        }

        .sound-toggle {
            margin-top: 25px; font-size: 0.75rem; color: #8892b0;
            display: flex; align-items: center; justify-content: center; gap: 10px;
            cursor: pointer; transition: all 0.3s;
            padding: 8px; border-radius: 12px;
            background: rgba(255, 255, 255, 0.03);
        }
        
        .sound-toggle.active { color: var(--accent-color); background: rgba(0, 212, 255, 0.05); }
        .sound-toggle:hover { color: #fff; }

    </style>
</head>
<body>

<canvas id="canvas"></canvas>

<div class="container">
    <div id="timer" onclick="toggleTimer()">25:00</div>
    
    <div class="controls">
        <button class="btn" id="ctrl" onclick="toggleTimer()">Engage</button>
        <button class="btn" onclick="resetTimer()">Reset</button>
    </div>

    <div class="sound-toggle" id="rainBtn" onclick="toggleRain()">
        <span id="speaker-icon">ðŸ”‡</span> RAIN AMBIENCE
    </div>
</div>

<audio id="rainSource" loop crossorigin="anonymous">
    <source src="rain.mp3" type="audio/mpeg">
</audio>

<script>
    // --- 1. URL CUSTOMIZATION ---
    const urlParams = new URLSearchParams(window.location.search);
    if(urlParams.get('accent')) {
        document.documentElement.style.setProperty('--accent-color', '#' + urlParams.get('accent'));
    }

    // --- 2. TIMER LOGIC ---
    let time = 25 * 60, running = false, interval;
    const timerDisplay = document.getElementById('timer');
    const ctrlBtn = document.getElementById('ctrl');

    function updateDisplay() {
        let m = Math.floor(time/60), s = time%60;
        timerDisplay.textContent = `${m}:${s<10?'0':''}${s}`;
    }

    function toggleTimer() {
        if(!running) {
            interval = setInterval(() => { 
                if(time > 0){
                    time--; 
                    updateDisplay();
                } else { 
                    stopTimer(); 
                    alert("Mission Phase Complete."); 
                } 
            }, 1000);
            ctrlBtn.textContent = 'Halt';
        } else {
            stopTimer();
        }
        running = !running;
    }

    function stopTimer() {
        clearInterval(interval);
        ctrlBtn.textContent = 'Engage';
    }

    function resetTimer() {
        stopTimer();
        running = false;
        time = 25 * 60;
        updateDisplay();
    }

    // --- 3. WEB AUDIO API (The Electronic Noise Fix) ---
    const rainAudio = document.getElementById('rainSource');
    const rainBtn = document.getElementById('rainBtn');
    const speakerIcon = document.getElementById('speaker-icon');
    
    let audioCtx;
    let track;

    function toggleRain() {
        // Initialize Audio Context on user gesture to fix browser jitter
        if (!audioCtx) {
            audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            track = audioCtx.createMediaElementSource(rainAudio);
            track.connect(audioCtx.destination);
        }

        if (audioCtx.state === 'suspended') {
            audioCtx.resume();
        }

        if (rainAudio.paused) {
            rainAudio.volume = 0.4; // Controlled volume
            rainAudio.play();
            rainBtn.classList.add('active');
            speakerIcon.textContent = 'ðŸ”Š';
        } else {
            rainAudio.pause();
            rainBtn.classList.remove('active');
            speakerIcon.textContent = 'ðŸ”‡';
        }
    }

    // --- 4. COSMIC BACKGROUND ---
    const canvas = document.getElementById('canvas'), ctx = canvas.getContext('2d');
    
    function resize() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
    }
    window.addEventListener('resize', resize);
    resize();

    let stars = Array(80).fill().map(() => ({
        x: Math.random() * canvas.width, 
        y: Math.random() * canvas.height,
        s: Math.random() * 2, 
        v: Math.random() * 0.3
    }));

    function animate() {
        ctx.clearRect(0,0,canvas.width,canvas.height);
        ctx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue('--accent-color');
        stars.forEach(p => {
            p.y -= p.v; 
            if(p.y < 0) p.y = canvas.height;
            ctx.beginPath(); 
            ctx.arc(p.x, p.y, p.s, 0, Math.PI*2); 
            ctx.fill();
        });
        requestAnimationFrame(animate);
    }
    animate();
</script>
</body>
</html>
