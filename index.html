<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Infinity Cosmic Sound Timer</title>
    <style>
        :root {
            --bg-color: #05070a;
            --text-color: #ffffff;
            --accent-color: #00d4ff;
        }

        body {
            margin: 0; padding: 0; height: 100vh; overflow: hidden;
            display: flex; justify-content: center; align-items: center;
            background: var(--bg-color);
            font-family: 'Inter', sans-serif;
            color: var(--text-color);
        }

        #canvas { position: fixed; top: 0; left: 0; z-index: 1; pointer-events: none; }

        .container {
            position: relative; z-index: 10;
            text-align: center; width: 280px;
            padding: 25px; border-radius: 28px;
            background: rgba(255,255,255,0.03);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255,255,255,0.1);
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }

        #timer {
            font-size: 4.5rem; font-weight: 200; margin: 10px 0;
            cursor: pointer; user-select: none;
            background: linear-gradient(to bottom, #fff, var(--accent-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .controls { display: flex; justify-content: center; gap: 10px; margin-top: 15px; }

        .btn {
            background: rgba(255,255,255,0.05); color: var(--text-color);
            border: 1px solid rgba(255,255,255,0.1);
            padding: 10px 20px; border-radius: 50px; cursor: pointer;
            font-size: 0.75rem; letter-spacing: 1px; transition: 0.3s;
        }

        .btn:hover { border-color: var(--accent-color); background: rgba(0,212,255,0.1); }

        /* Sound Control Switch */
        .sound-toggle {
            margin-top: 20px; font-size: 0.7rem; color: #8892b0;
            display: flex; align-items: center; justify-content: center; gap: 8px;
            cursor: pointer; opacity: 0.6; transition: 0.3s;
        }
        .sound-toggle:hover { opacity: 1; }
        .sound-toggle.active { color: var(--accent-color); opacity: 1; }

    </style>
</head>
<body>

<canvas id="canvas"></canvas>

<div class="container">
    <div id="timer" onclick="toggleTimer()">25:00</div>
    
    <div class="controls">
        <button class="btn" id="ctrl" onclick="toggleTimer()">ENGAGE</button>
        <button class="btn" onclick="resetTimer()">RESET</button>
    </div>

    <div class="sound-toggle" id="rainBtn" onclick="toggleRain()">
        <span id="speaker-icon">ðŸ”‡</span> RAIN AMBIENCE
    </div>
</div>

<audio id="rainSource" loop>
    <source src="rain.mp3" type="audio/mpeg">
    </audio>

<script>
    // --- URL CUSTOMIZATION ---
    const urlParams = new URLSearchParams(window.location.search);
    if(urlParams.get('accent')) document.documentElement.style.setProperty('--accent-color', '#' + urlParams.get('accent'));

    // --- TIMER LOGIC ---
    let time = 25 * 60, running = false, interval;
    const timerDisplay = document.getElementById('timer');
    const ctrlBtn = document.getElementById('ctrl');

    function updateDisplay() {
        let m = Math.floor(time/60), s = time%60;
        timerDisplay.textContent = `${m}:${s<10?'0':''}${s}`;
    }

    function toggleTimer() {
        if(!running) {
            interval = setInterval(() => { if(time>0){time--; updateDisplay();} else { stopTimer(); alert("Session Complete."); } }, 1000);
            ctrlBtn.textContent = 'HALT';
        } else {
            stopTimer();
        }
        running = !running;
    }

    function stopTimer() {
        clearInterval(interval);
        ctrlBtn.textContent = 'ENGAGE';
    }

    function resetTimer() {
        stopTimer();
        running = false;
        time = 25 * 60;
        updateDisplay();
    }

    // --- RAIN SOUND LOGIC ---
    const rainAudio = document.getElementById('rainSource');
    const rainBtn = document.getElementById('rainBtn');
    const speakerIcon = document.getElementById('speaker-icon');

    function toggleRain() {
        if (rainAudio.paused) {
            rainAudio.play();
            rainBtn.classList.add('active');
            speakerIcon.textContent = 'ðŸ”Š';
        } else {
            rainAudio.pause();
            rainBtn.classList.remove('active');
            speakerIcon.textContent = 'ðŸ”‡';
        }
    }

    // --- COSMIC BACKGROUND (Atoms/Stars) ---
    const canvas = document.getElementById('canvas'), ctx = canvas.getContext('2d');
    canvas.width = window.innerWidth; canvas.height = window.innerHeight;
    let stars = Array(80).fill().map(() => ({
        x: Math.random()*canvas.width, y: Math.random()*canvas.height,
        s: Math.random()*2, v: Math.random()*0.3
    }));

    function animate() {
        ctx.clearRect(0,0,canvas.width,canvas.height);
        ctx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue('--accent-color');
        stars.forEach(p => {
            p.y -= p.v; if(p.y<0) p.y=canvas.height;
            ctx.beginPath(); ctx.arc(p.x, p.y, p.s, 0, Math.PI*2); ctx.fill();
        });
        requestAnimationFrame(animate);
    }
    animate();
</script>
</body>
</html>
